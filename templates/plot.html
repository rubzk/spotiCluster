{% extends "base.html" %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static',filename='styles/plot.css') }}">


<div class="loading-plots" id="loading-plots">

    <h1>Loading plots....</h1>

</div>

<div class="container-plots" id="test">

    <div class="title-container">

        <h1>3D Overview of your data</h1>
    
    </div>

    <div class="first-div">

        <div class="chart" id="keys_bar"></div>
        <div class="chart" id="mode_bar"></div>
        <div class="chart" id="cluster_bar"></div>

    </div>
    <div class="polar-div">
        <div class="chart" id="polar"></div>
    </div>
    <div class="scatter-div">
        <div class="chart" id="scatter_matrix"></div>
    </div>
    
</div>

<script>

    var taskId = '{{task_id | safe}}'

    var resultFound = false;

    let plotsWrapper = document.getElementById('test')

    var fetchNow = function() {
    fetch('/status/'+taskId)
    .then(res => res.json())
    .then(data => {
        if(data['plots']) {
        plotsWrapper.style.display = 'flex';
        document.getElementById('loading-plots').style.display = 'none';
        data_p = JSON.parse(data['plots'])
        var layout = {}
        //function to draw all the plots
        for (const [key, value] of Object.entries(data_p)) {
            if (key == "scatter3d"){
                console.log(key, value)
            }
            else {
                Plotly.newPlot(key, data_p[key], layout, {responsive:true})
                console.log(key, value)   
            }
        }
        }
        else {
        console.log(data['status'])
        fetchNow();
        }
    });
    }

    fetchNow();

</script>

{% endblock %}