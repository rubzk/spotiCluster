{% extends "base.html" %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static',filename='styles/plot.css') }}">


<div class="loading-plots" id="loading-plots">

    <h1>Loading plots....</h1>

</div>


<div class="plots">

    <div class="title-container" id="title">

        <h1>3D Overview of your data</h1>

    </div>

    <div class="first-div" id="first-row">

        <div class="chart" id="keys_bar"></div>
        <div class="chart" id="mode_bar"></div>
        <div class="chart" id="cluster_bar"></div>

    </div>

    <div class="scatter-3d_1" id="forth-row">
        <div class="chart" id="scatter-1"></div>
        <div class="chart" id="scatter-2"></div>
    </div>

    <div class="scatter-3d_2" id="fifth-row">
        <div class="chart" id="scatter-3"></div>
        <div class="chart" id="scatter-4"></div>
    </div>



    <div class="polar-div" id="second-row">
        <h2>Radar Chart</h2>
        <div class="chart" id="polar"></div>
    </div>
    <div class="scatter-div" id="third-row">
        <h2>Scatter Matrix</h2>
        <div class="chart" id="scatter_matrix"></div>
    </div>
</div>


<script>

    var asd = 9000;

    var taskId = '{{task_id | safe}}'

    var resultFound = false;

    var fetchNow = function() {
    fetch('/status/'+taskId)
    .then(res => res.json())
    .then(data => {
        if(data['plots']) {
        document.getElementById("title").style.display = 'flex';

        //document.getElementById("title").innerHTML = asd;

        document.getElementById("first-row").style.display = 'flex';

        document.getElementById("second-row").style.display = 'flex';

        document.getElementById("third-row").style.display = 'flex';

        document.getElementById("forth-row").style.display = 'flex';

        document.getElementById("fifth-row").style.display = 'flex';

        document.getElementById('loading-plots').style.display = 'none';

        data_p = JSON.parse(data['plots'])
        var layout = {}
        //function to draw all the plots
        for (const [key, value] of Object.entries(data_p)) {
            if (key == "scatter3d"){
                console.log(key, value)
                Plotly.newPlot("scatter-1", data_p[key][1], layout, {responsive:true})
                Plotly.newPlot("scatter-2", data_p[key][2], layout, {responsive:true})
                Plotly.newPlot("scatter-3", data_p[key][3], layout, {responsive:true})
                Plotly.newPlot("scatter-4", data_p[key][4], layout, {responsive:true})
            }
            else {
                Plotly.newPlot(key, data_p[key], layout, {responsive:true})
                console.log(key, value)   
            }
        }
        }
        else {
        console.log(data['status'])
        fetchNow();
        }
    });
    }

    fetchNow();

</script>

{% endblock %}